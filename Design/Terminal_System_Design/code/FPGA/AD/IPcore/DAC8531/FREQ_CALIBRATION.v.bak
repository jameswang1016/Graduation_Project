/*
f=10MHZ
DAC8531 16bit(0~65535) 0~5V
*/

module FREQ_CALIBRATION(
    input   wire                CLK,
    input   wire                RESET_N,
    input   wire                GPS_PPS,
    input   wire                GPS_LOCK,
    output  wire                DA_CS,
    output  wire                DA_SCLK,
    output  wire                DA_SDO
    );


    wire          OVER;
    reg  [24:0]   DATA = 12000; 
    reg           TR = 0;

    reg  [ 3:0]   state = 0;


    always @(posedge CLK) begin
        if (!RESET_N) begin
            state <= 0;
            TR <= 0;
        end else begin
            case (state)
                0:  begin
                        state <= 1;
                        DATA <= DATA < 30000 ? DATA + 1 : 1; 
                        TR <= 0;
                    end

                1:  begin
                        if (OVER) begin
                            TR <= 1;
                            state <= 2;
                        end
                    end

                2:  begin
                        TR <= 1;
                        state <= 3;
                    end

                3:  begin
                        TR <= 0;
                        state <= 4;
                    end

                4:  begin
                        state <= 0;
                    end
                default: state <= 0;
            endcase
        end 
    end



    DAC9531_DATA_ACCESS inst1(
        .CLK          (CLK),
        .RESET_N      (RESET_N),
        .TR           (TR),
        .DATA         (DATA),
        .DA_CS        (DA_CS),
        .DA_SCLK      (DA_SCLK),
        .DA_SDO       (DA_SDO),
        .OVER         (OVER)
    );

endmodule
